import{_ as c,r as i,c as d,o as a,a as n,b as o,w as e,d as r,e as p,S as t}from"./chunks/plugin-vue_export-helper.BFoZFeGM.js";const C=JSON.parse('{"title":"Architecture","description":"","frontmatter":{},"headers":[],"relativePath":"architecture.md","filePath":"architecture.md","lastUpdated":1767596577000}'),u={name:"architecture.md"};function y(E,s,b,m,h,A){const l=i("Mermaid");return a(),d("div",null,[s[3]||(s[3]=n("",4)),(a(),o(t,null,{default:e(()=>[p(l,{id:"mermaid-17",class:"mermaid my-class",graph:"flowchart%20TB%0A%20%20%20%20subgraph%20External%5B%22External%20Data%20Source%22%5D%0A%20%20%20%20%20%20%20%20DB%5B(MySQL%20%2F%20PostgreSQL*)%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20Cluster%5B%22Kubernetes%20Cluster%22%5D%0A%20%20%20%20%20%20%20%20direction%20TB%0A%0A%20%20%20%20%20%20%20%20subgraph%20Controllers%5B%22Operator%20Controllers%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20RC%5BLynqHub%20Controller%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20TC%5BLynqForm%20Controller%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20TNC%5BLynqNode%20Controller%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20subgraph%20CRDs%5B%22Custom%20Resources%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20TR%5BLynqHub%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20TT%5BLynqForm%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20T%5BLynqNode%20CRs%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20subgraph%20Engine%5B%22Apply%20Engine%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20SSA%5B%22SSA%20Apply%20Engine%3Cbr%2F%3E(fieldManager%3A%20lynq)%22%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20subgraph%20Resources%5B%22Kubernetes%20Resources%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20DEP%5BDeployments%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20SVC%5BServices%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20ING%5BIngresses%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20etc%5BConfigMaps%2C%20Secrets%2C%20...%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20API%5B(etcd%20%2F%20K8s%20API%20Server)%5D%0A%20%20%20%20end%0A%0A%20%20%20%20DB%20--%3E%7C%22syncInterval%3Cbr%2F%3E(e.g.%2C%201m)%22%7C%20RC%0A%20%20%20%20RC%20--%3E%7C%22Creates%2FUpdates%2FDeletes%3Cbr%2F%3ELynqNode%20CRs%22%7C%20API%0A%20%20%20%20API%20--%3E%7C%22Stores%22%7C%20TR%0A%20%20%20%20API%20--%3E%7C%22Stores%22%7C%20TT%0A%20%20%20%20API%20--%3E%7C%22Stores%22%7C%20T%0A%0A%20%20%20%20TC%20--%3E%7C%22Validates%3Cbr%2F%3Etemplate-registry%20linkage%22%7C%20API%0A%20%20%20%20TNC%20--%3E%7C%22Reconciles%3Cbr%2F%3Eeach%20LynqNode%22%7C%20SSA%0A%20%20%20%20SSA%20--%3E%7C%22Server-Side%20Apply%22%7C%20API%0A%0A%20%20%20%20API%20--%3E%7C%22Creates%22%7C%20DEP%0A%20%20%20%20API%20--%3E%7C%22Creates%22%7C%20SVC%0A%20%20%20%20API%20--%3E%7C%22Creates%22%7C%20ING%0A%20%20%20%20API%20--%3E%7C%22Creates%22%7C%20etc%0A%0A%20%20%20%20style%20RC%20fill%3A%23e3f2fd%2Cstroke%3A%2364b5f6%2Cstroke-width%3A2px%0A%20%20%20%20style%20TC%20fill%3A%23e8f5e9%2Cstroke%3A%2381c784%2Cstroke-width%3A2px%0A%20%20%20%20style%20TNC%20fill%3A%23fff3e0%2Cstroke%3A%23ffb74d%2Cstroke-width%3A2px%0A%20%20%20%20style%20SSA%20fill%3A%23fce4ec%2Cstroke%3A%23f06292%2Cstroke-width%3A2px%0A%20%20%20%20style%20DB%20fill%3A%23f3e5f5%2Cstroke%3A%23ba68c8%2Cstroke-width%3A2px%0A"})]),fallback:e(()=>[...s[0]||(s[0]=[r(" Loading... ",-1)])]),_:1})),s[4]||(s[4]=n("",6)),(a(),o(t,null,{default:e(()=>[p(l,{id:"mermaid-94",class:"mermaid my-class",graph:"sequenceDiagram%0A%20%20%20%20participant%20DB%20as%20MySQL%20Database%0A%20%20%20%20participant%20RC%20as%20LynqHub%20Controller%0A%20%20%20%20participant%20API%20as%20K8s%20API%20Server%0A%20%20%20%20participant%20TC%20as%20LynqForm%20Controller%0A%20%20%20%20participant%20TNC%20as%20LynqNode%20Controller%0A%20%20%20%20participant%20SSA%20as%20SSA%20Engine%0A%0A%20%20%20%20Note%20over%20DB%2CSSA%3A%20Hub%20Sync%20Cycle%20(e.g.%2C%20every%201%20minute)%0A%0A%20%20%20%20RC-%3E%3EDB%3A%20SELECT%20*%20FROM%20nodes%20WHERE%20activate%3DTRUE%0A%20%20%20%20DB--%3E%3ERC%3A%20Active%20node%20rows%0A%0A%20%20%20%20RC-%3E%3EAPI%3A%20Create%2FUpdate%20LynqNode%20CRs%20(desired%20set)%0A%20%20%20%20RC-%3E%3EAPI%3A%20Delete%20LynqNodes%20not%20in%20desired%20set%0A%0A%20%20%20%20TC-%3E%3EAPI%3A%20Validate%20Template-Registry%20linkage%0A%20%20%20%20TC-%3E%3EAPI%3A%20Ensure%20consistency%0A%0A%20%20%20%20loop%20For%20Each%20LynqNode%0A%20%20%20%20%20%20%20%20TNC-%3E%3EAPI%3A%20Get%20LynqNode%20spec%0A%20%20%20%20%20%20%20%20TNC-%3E%3ETNC%3A%20Build%20dependency%20graph%20(dependIds)%0A%20%20%20%20%20%20%20%20TNC-%3E%3ETNC%3A%20Topological%20sort%20resources%0A%0A%20%20%20%20%20%20%20%20loop%20For%20Each%20Resource%20(in%20order)%0A%20%20%20%20%20%20%20%20%20%20%20%20TNC-%3E%3ETNC%3A%20Render%20templates%20(name%2C%20namespace%2C%20spec)%0A%20%20%20%20%20%20%20%20%20%20%20%20TNC-%3E%3ESSA%3A%20Apply%20resource%20with%20conflict%20policy%0A%20%20%20%20%20%20%20%20%20%20%20%20SSA-%3E%3EAPI%3A%20Server-Side%20Apply%20(force%20or%20not)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20alt%20waitForReady%20%3D%20true%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20TNC-%3E%3EAPI%3A%20Wait%20for%20resource%20Ready%20condition%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20API--%3E%3ETNC%3A%20Ready%20(or%20timeout)%0A%20%20%20%20%20%20%20%20%20%20%20%20end%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20TNC-%3E%3EAPI%3A%20Update%20LynqNode%20status%20(ready%2Ffailed%20counts)%0A%20%20%20%20end%0A%0A%20%20%20%20RC-%3E%3EAPI%3A%20Update%20Hub%20status%20(desired%2Fready%2Ffailed)%0A"})]),fallback:e(()=>[...s[1]||(s[1]=[r(" Loading... ",-1)])]),_:1})),s[5]||(s[5]=n("",68)),(a(),o(t,null,{default:e(()=>[p(l,{id:"mermaid-697",class:"mermaid my-class",graph:"sequenceDiagram%0A%20%20%20%20participant%20TNC%20as%20LynqNode%20Controller%0A%20%20%20%20participant%20API%20as%20K8s%20API%20Server%0A%20%20%20%20participant%20RES%20as%20Kubernetes%20Resource%0A%0A%20%20%20%20Note%20over%20TNC%2CRES%3A%20Phase%201%3A%20Orphan%20Detection%0A%0A%20%20%20%20TNC-%3E%3EAPI%3A%20Get%20LynqNode%20status.appliedResources%0A%20%20%20%20API--%3E%3ETNC%3A%20%5B%22Deployment%2Fns%2Fapp%40deploy%22%2C%20%22Service%2Fns%2Fsvc%40service%22%2C%20%22ConfigMap%2Fns%2Fold%40config%22%5D%0A%0A%20%20%20%20TNC-%3E%3ETNC%3A%20Calculate%20current%20desired%20resources%0A%20%20%20%20Note%20right%20of%20TNC%3A%20%5B%22Deployment%2Fns%2Fapp%40deploy%22%2C%20%22Service%2Fns%2Fsvc%40service%22%5D%3Cbr%2F%3EConfigMap%20removed%20from%20template%0A%0A%20%20%20%20TNC-%3E%3ETNC%3A%20Detect%20orphans%3A%20appliedResources%20-%20desiredResources%0A%20%20%20%20Note%20right%20of%20TNC%3A%20Orphan%3A%20%22ConfigMap%2Fns%2Fold%40config%22%0A%0A%20%20%20%20Note%20over%20TNC%2CRES%3A%20Phase%202%3A%20Orphan%20Cleanup%0A%0A%20%20%20%20TNC-%3E%3EAPI%3A%20Get%20ConfigMap%20(read%20lynq.sh%2Fdeletion-policy%20annotation)%0A%20%20%20%20API--%3E%3ETNC%3A%20ConfigMap%20with%20deletion-policy%3A%20%22Retain%22%0A%0A%20%20%20%20alt%20DeletionPolicy%20%3D%20Delete%0A%20%20%20%20%20%20%20%20TNC-%3E%3EAPI%3A%20Delete%20ConfigMap%0A%20%20%20%20%20%20%20%20API--%3E%3ETNC%3A%20Deleted%0A%20%20%20%20else%20DeletionPolicy%20%3D%20Retain%0A%20%20%20%20%20%20%20%20TNC-%3E%3EAPI%3A%20Patch%20ConfigMap%3A%20add%20orphan%20labels%2Fannotations%0A%20%20%20%20%20%20%20%20Note%20right%20of%20API%3A%20%2B%20lynq.sh%2Forphaned%3A%20%22true%22%3Cbr%2F%3E%2B%20lynq.sh%2Forphaned-at%3A%20%222024-01-15T10%3A30%3A00Z%22%3Cbr%2F%3E%2B%20lynq.sh%2Forphaned-reason%3A%20%22RemovedFromTemplate%22%0A%20%20%20%20%20%20%20%20API--%3E%3ETNC%3A%20Updated%0A%20%20%20%20end%0A%0A%20%20%20%20Note%20over%20TNC%2CRES%3A%20Phase%203%3A%20Re-adoption%20(if%20resource%20added%20back)%0A%0A%20%20%20%20TNC-%3E%3ETNC%3A%20ConfigMap%20re-added%20to%20template%0A%20%20%20%20TNC-%3E%3EAPI%3A%20Apply%20ConfigMap%20with%20SSA%0A%20%20%20%20Note%20right%20of%20API%3A%20-%20lynq.sh%2Forphaned%3A%20removed%3Cbr%2F%3E-%20lynq.sh%2Forphaned-at%3A%20removed%3Cbr%2F%3E-%20lynq.sh%2Forphaned-reason%3A%20removed%3Cbr%2F%3E%2B%20ownerReference%3A%20restored%20(if%20same%20namespace)%0A%20%20%20%20API--%3E%3ETNC%3A%20Applied%0A%0A%20%20%20%20TNC-%3E%3EAPI%3A%20Update%20LynqNode%20status.appliedResources%0A%20%20%20%20Note%20right%20of%20API%3A%20%5B%22Deployment%2Fns%2Fapp%40deploy%22%2C%20%22Service%2Fns%2Fsvc%40service%22%2C%20%22ConfigMap%2Fns%2Fold%40config%22%5D%0A"})]),fallback:e(()=>[...s[2]||(s[2]=[r(" Loading... ",-1)])]),_:1})),s[6]||(s[6]=n("",17))])}const g=c(u,[["render",y]]);export{C as __pageData,g as default};
